---
// src/pages/cartas/[slug].astro

import Layout from "../../layouts/Layout.astro";
import { menuItems } from "../../data/menuData.jsx";
import { connectDB } from "../../../api/mongoose.js";
import MenuItem from "../../../api/models/MenuItem.js";

const { slug } = Astro.params;

const menuItem = menuItems.find((item) => item.slug === slug);

if (!menuItem) {
  return Astro.redirect("/404");
}

await connectDB();
const dbItems = await MenuItem.find({ categoria: menuItem.dbCategory });

const pageTitle = menuItem.name;
---

<Layout
  title={`${pageTitle} | Restaurante Van Gogh`}
  description={`Consulta nuestra ${pageTitle} completa. Platos, bebidas y más.`}
>
  <div class="flex flex-col lg:flex-row min-h-screen bg-[#051024]">
    <!-- Sidebar Image (Left) -->
    <div
      class="hidden lg:block lg:w-1/3 xl:w-1/4 h-screen sticky top-0 overflow-hidden relative"
    >
      <img
        src="/menu-sidebar.jpeg"
        alt="Arte Van Gogh"
        class="w-full h-full object-cover"
      />
      <!-- Gradient Fade Overlay -->
      <div
        class="absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-[#051024] opacity-90"
      >
      </div>
    </div>

    <!-- Main Content (Right) -->
    <div class="flex-1 px-6 py-8 lg:px-12 lg:py-12 relative">
      <!-- Top Logo -->
      <div class="flex justify-center lg:justify-end mb-12">
        <img
          src="/menu-logo.jpeg"
          alt="Van Gogh Fusions Et Café"
          class="h-24 md:h-32 object-contain mix-blend-screen"
        />
      </div>

      <!-- Category Label -->
      <h1
        class="text-4xl md:text-5xl font-bold text-yellow-400 font-serif mb-12 uppercase tracking-wide border-b-2 border-yellow-400/30 pb-4 inline-block"
      >
        {pageTitle}
      </h1>

      <!-- Menu Items Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-12 max-w-5xl">
        {
          dbItems.length > 0 ? (
            dbItems.map((item) => (
              <div class="group">
                <div class="flex justify-between items-baseline border-b border-gray-600 pb-2 mb-2 border-dotted">
                  <h3 class="text-xl md:text-2xl font-bold text-gray-100 font-serif tracking-wide group-hover:text-yellow-300 transition-colors">
                    {item.nombre}
                  </h3>
                  <span class="text-xl font-bold text-yellow-400 font-sans whitespace-nowrap ml-4">
                    S/. {item.precio.toFixed(2)}
                  </span>
                </div>

                <p class="text-gray-400 text-sm md:text-base italic font-light ml-2 leading-relaxed">
                  {item.descripcion || ""}
                </p>
              </div>
            ))
          ) : (
            <div class="col-span-full text-center text-gray-500 text-xl italic py-20">
              Próximamente nuevas delicias...
            </div>
          )
        }
      </div>

      <!-- Download Button -->
      <!-- <div class="text-center lg:text-left mt-24">
        <a
          href={`/cartas/${slug}.pdf`}
          download
          class="inline-block border border-yellow-400 text-yellow-400 font-bold py-3 px-8 rounded-full text-sm hover:bg-yellow-400 hover:text-blue-900 transition-all duration-300"
        >
          Descargar Carta (PDF)
        </a>
      </div> -->
    </div>
  </div>
</Layout>
